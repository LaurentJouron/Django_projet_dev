{% load static %}
{% load django_vite %}

{% block content %}
    <div class="grid lg:grid-cols-[1fr_540px] h-screen bg-white dark:bg-black">
        <div class="relative bg-white dark:bg-black flex items-center justify-center">
            <img class="object-contain max-h-screen" src="{{ post.image.url }}">

            <button id="close-button"
                    x-show="modalPage"
                    @click="modalPage = false; document.getElementById('modalpage-content').innerHTML = ''; window.history.replaceState({}, '', returnUrl); "  
                    class="absolute left-5 top-5 rounded-full size-10 bg-neutral-700/70 hover:bg-neutral-800/70 flex items-center justify-center transition duration-300">
                <div class="size-6 fill-white">
                    <svg viewBox="0 0 48 48">
                        <path d="M38.7 12.12a1 1 0 0 0 0-1.41l-1.4-1.42a1 1 0 0 0-1.42 0L24 21.17 12.12 9.3a1 1 0 0 0-1.41 0l-1.42 1.42a1 1 0 0 0 0 1.41L21.17 24 9.3 35.88a1 1 0 0 0 0 1.41l1.42 1.42a1 1 0 0 0 1.41 0L24 26.83 35.88 38.7a1 1 0 0 0 1.41 0l1.42-1.42a1 1 0 0 0 0-1.41L26.83 24 38.7 12.12Z"></path>
                    </svg>
                </div>
            </button>

            <a x-show="!modalPage" href="/">
                <img src="{% vite_asset_url 'images/short_logo-rounded.png' %}"
                class="absolute left-5 top-5 rounded-full size-10 hover:bg-white flex items-center justify-center transition duration-300" 
                alt="">
            </a>

            <scroll-bar class="absolute right-5 top-0 h-full flex items-center">
                <div class="flex flex-col gap-4">

                    {% if prev_post %}
                        <button @click="window.location.href = '{% url 'posts:post_page' prev_post.uuid %}'" class="size-10 rounded-full bg-neutral-700/70 hover:bg-neutral-800/70 flex items-center justify-center transition duration-300">
                            <div class="size-6 fill-white">
                                <svg viewBox="0 0 48 48">
                                    <path d="m24 20.24 13.17 13.17a1 1 0 0 0 1.42 0l2.82-2.82a1 1 0 0 0 0-1.42L25.06 12.82a1.5 1.5 0 0 0-2.12 0L6.59 29.17a1 1 0 0 0 0 1.42L9.4 33.4a1 1 0 0 0 1.42 0L24 20.24Z"></path>
                                </svg>
                            </div>
                        </button>
                    {% else %}
                        <div class="size-10"></div>
                    {% endif %}

                    {% if next_post %}
                        <button @click="window.location.href = '{% url 'posts:post_page' next_post.uuid %}'" class="size-10 rounded-full bg-neutral-700/70 hover:bg-neutral-800/70 flex items-center justify-center transition duration-300">
                            <div class="size-6 fill-white">
                                <svg viewBox="0 0 48 48">
                                    <path d="m24 27.76 13.17-13.17a1 1 0 0 1 1.42 0l2.82 2.82a1 1 0 0 1 0 1.42L25.06 35.18a1.5 1.5 0 0 1-2.12 0L6.59 18.83a1 1 0 0 1 0-1.42L9.4 14.6a1 1 0 0 1 1.42 0L24 27.76Z"></path>
                                </svg>
                            </div>
                        </button>
                    {% else %}
                        <div class="size-10"></div>
                    {% endif %}

                </div>
            </scroll-bar>
        </div>

        <div class="hidden lg:block">
            <div class="flex flex-col gap-5 h-screen">
                <article-info class="block mx-4 mt-4">
                    <div class="bg-neutral-100 dark:bg-neutral-900 rounded-xl p-4">

                        {% if post.author %}
                            <div class="flex items-center justify-between">
                                <a href="{% url 'users:profile' post.author.username %}" class="flex items-center gap-3">
                                    <div class="shrink-0 size-12 rounded-full overflow-hidden">
                                        <img src="{{ post.author.avatar }}" class="w-full h-full object-cover">
                                    </div>
                                    <div>
                                        <div class="font-medium hover:underline">{{ post.author.username }}</div>
                                        <div class="text-sm -mt-0.5">
                                            <span>{{ post.author.name }}</span>
                                            <span class="mx-1"> · </span>
                                            <span>{{ post.created_at|timesince }}</span>
                                        </div>
                                    </div>
                                </a>
                                {% if post.author == user %}
                                <button @click="modalBox = true" 
                                        hx-get={% url 'posts:post_edit' post.uuid %}
                                        hx-target="#modalbox-content"
                                        hx-swap="innerHTML"
                                        class="size-10 rounded-full hover:bg-neutral-200 dark:bg-neutral-700 dark:hover:bg-neutral-600 flex items-center justify-center">
                                    <div class="size-6">
                                        <svg viewBox="0 0 48 48">
                                            <path d="M5 24a4 4 0 1 1 8 0 4 4 0 0 1-8 0Zm15 0a4 4 0 1 1 8 0 4 4 0 0 1-8 0Zm15 0a4 4 0 1 1 8 0 4 4 0 0 1-8 0Z"></path>
                                        </svg>
                                    </div>
                                </button>
                                {% else %}
                                <button class="bg-[#366BF5] hover:bg-[#5037F8] rounded-md px-6 py-2 text-white">
                                    Se connecter
                                </button>
                                {% endif %}
                            </div>
                        {% endif %}

                        {% if post.body %}
                            <div class="mt-3">{{ post.body }}</div>
                        {% endif %}

                        {% if post.tags %}
                            <div class="mt-3">
                                {% for tag in post.tags.split %}
                                    <a href="" class="text-sm hover:underline mr-2">{{ tag }}</a>
                                {% endfor %}
                            </div>
                        {% endif %}

                    </div>
                </article-info>
                
                <article-buttons class="mx-8 flex items-center gap-4">
                    {% include "./_like_postpage.html" %}

                    <button id="comments" class="flex items-center gap-1">
                        <div class="button-article !size-8 dark:!bg-neutral-800 hover:dark:!bg-neutral-900">
                            <div class="size-5">
                                <svg viewBox="0 0 48 48">
                                    <path fill-rule="evenodd" d="M2 21.5c0-10.22 9.88-18 22-18s22 7.78 22 18c0 5.63-3.19 10.74-7.32 14.8a43.6 43.6 0 0 1-14.14 9.1A1.5 1.5 0 0 1 22.5 44v-5.04C11.13 38.4 2 31.34 2 21.5M14 25a3 3 0 1 0 0-6 3 3 0 0 0 0 6m10 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6m13-3a3 3 0 1 1-6 0 3 3 0 0 1 6 0" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="font-bold text-xs text-neutral-600 dark:text-neutral-400">3</div>
                    </button>

                    <button id="bookmark" class="flex items-center gap-1">
                        <div class="button-article !size-8 dark:!bg-neutral-800 hover:dark:!bg-neutral-900">
                            <div class="size-5">
                                <svg viewBox="0 0 24 24">
                                    <path d="M4 4.5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v15.13a1 1 0 0 1-1.555.831l-6.167-4.12a.5.5 0 0 0-.556 0l-6.167 4.12A1 1 0 0 1 4 19.63z"></path>                                                                                         
                                </svg>
                            </div>
                        </div>
                        <div class="font-bold text-xs text-neutral-600 dark:text-neutral-400">3</div>
                    </button>

                    <button id="share" class="ml-auto flex items-center gap-1">
                        <div class="button-article !size-8 dark:!bg-neutral-800 hover:dark:!bg-neutral-900">
                            <div class="size-5">
                                <svg viewBox="0 0 20 20">
                                    <path d="M10.938 3.175a.674.674 0 0 1 1.138-.488l6.526 6.215c.574.547.554 1.47-.043 1.991l-6.505 5.676a.674.674 0 0 1-1.116-.508V13.49s-6.985-1.258-9.225 2.854c-.209.384-1.023.518-.857-1.395.692-3.52 2.106-9.017 10.082-9.017z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                        </div>
                    </button>
                </article-buttons>

                <article-url x-data="{ copyLink() { navigator.clipboard.writeText($refs.urlLink.innerText); } }" class="mx-8 flex items-center bg-neutral-100 dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-800 text-sm">
                    <span x-ref="urlLink" class="grow px-4 py-2 text-neutral-500 dark:text-neutral-400 truncate">
                        {{ requet.scheme }}://{{ request.get_host }}{% url 'posts:post_page' post.uuid %}
                    </span>
                    <button @click="copyLink" class="shrink-0 px-4 py-2 font-bold hover:bg-neutral-50 dark:hover:bg-neutral-900 active:bg-neutral-200 dark:active:bg-black transition-colors">
                        Copier le lien
                    </button>
                </article-url>

                <article-comments x-data="{ selectedTab: 'comments' }" class="relative grow mt-2 overflow-hidden flex flex-col">
                    <div class="grid grid-cols-2 px-8 text-sm text-center font-medium border-b border-neutral-300 dark:border-neutral-700">
                        <button @click="selectedTab = 'comments'" class="border-b-2 pb-2" :class="selectedTab === 'comments' ? 'border-[#366BF5] text-[#366BF5] dark:border-white' : 'text-neutral-400 border-transparent'">
                            Commentaire(s) - (3)
                        </button>
                        <button @click="selectedTab = 'posts'" class="border-b-2 pb-2" :class="selectedTab === 'posts' ? 'border-[#366BF5] text-[#366BF5] dark:border-white' : 'text-neutral-400 border-transparent'">
                            Publications du créateur
                        </button>
                    </div>
                    <div x-show="selectedTab === 'comments'" class="px-8 py-6 overflow-y-auto hide-scrollbar mb-24">
                        <div class="flex flex-col gap-6">
                            <comment-item class="flex gap-3 w-full">
                                <div class="shrink-0 rounded-full size-12 overflow-hidden">
                                    <img src="/media/avatars/Laurent_Jouron.png" class="w-full h-full object-cover">
                                </div>
                                <div class="grow flex justify-between">
                                    <div>
                                        <div class="font-medium">Laurent Jouron</div>
                                        <div class="leading-5">C'est un commentaire</div>
                                        <div class="flex gap-4 text-neutral-400 text-sm mt-1">
                                            <span>2h ago</span>
                                            <button>Répondre</button>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="p-2">
                                            <div class="size-5 fill-neutral-500">
                                                <svg viewBox="0 0 48 48">
                                                    <path d="M40.96 24.15c1.83-4.8 1.05-8.61-.8-11.33a10.87 10.87 0 0 0-6.34-4.49 9.43 9.43 0 0 0-6.83 1.17c-1.08.65-2.1 1.53-2.99 2.66-.9-1.13-1.9-2.01-3-2.66a9.43 9.43 0 0 0-6.82-1.17 10.87 10.87 0 0 0-6.34 4.49c-1.85 2.72-2.63 6.54-.8 11.33 1.43 3.74 4.5 7.23 7.6 9.98a46.31 46.31 0 0 0 8.6 6.12l.76.4.76-.4a46.31 46.31 0 0 0 8.6-6.12c3.1-2.75 6.17-6.24 7.6-9.98ZM24 17.58c2.3-2.88 4.7-6.2 9.03-5.33a6.95 6.95 0 0 1 3.82 2.81c1.07 1.58 1.76 4.02.37 7.66-1.09 2.86-3.6 5.82-6.51 8.43A44.84 44.84 0 0 1 24 36.09a44.84 44.84 0 0 1-6.7-4.94c-2.93-2.6-5.43-5.57-6.52-8.43-1.4-3.64-.7-6.08.37-7.66a6.95 6.95 0 0 1 3.82-2.8c4.33-.88 6.73 2.44 9.03 5.32Z"></path>
                                                </svg>
                                            </div>
                                            <div class="text-neutral-500 text-sm">3</div>
                                        </button>
                                    </div>
                                </div>
                            </comment-item>

                            <comment-item class="flex gap-3 w-full">
                                <div class="shrink-0 rounded-full size-12 overflow-hidden">
                                    <img src="/media/Laurent_Jouron.png" class="w-full h-full object-cover">
                                </div>
                                <div class="grow flex justify-between">
                                    <div>
                                        <div class="font-medium">Laurent Jouron</div>
                                        <div class="leading-5">C'est un commentaire</div>
                                        <div class="flex gap-4 text-neutral-400 text-sm mt-1">
                                            <span>2h ago</span>
                                            <button>Répondre</button>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="p-2">
                                            <div class="size-5 fill-neutral-500">
                                                <svg viewBox="0 0 48 48">
                                                    <path d="M40.96 24.15c1.83-4.8 1.05-8.61-.8-11.33a10.87 10.87 0 0 0-6.34-4.49 9.43 9.43 0 0 0-6.83 1.17c-1.08.65-2.1 1.53-2.99 2.66-.9-1.13-1.9-2.01-3-2.66a9.43 9.43 0 0 0-6.82-1.17 10.87 10.87 0 0 0-6.34 4.49c-1.85 2.72-2.63 6.54-.8 11.33 1.43 3.74 4.5 7.23 7.6 9.98a46.31 46.31 0 0 0 8.6 6.12l.76.4.76-.4a46.31 46.31 0 0 0 8.6-6.12c3.1-2.75 6.17-6.24 7.6-9.98ZM24 17.58c2.3-2.88 4.7-6.2 9.03-5.33a6.95 6.95 0 0 1 3.82 2.81c1.07 1.58 1.76 4.02.37 7.66-1.09 2.86-3.6 5.82-6.51 8.43A44.84 44.84 0 0 1 24 36.09a44.84 44.84 0 0 1-6.7-4.94c-2.93-2.6-5.43-5.57-6.52-8.43-1.4-3.64-.7-6.08.37-7.66a6.95 6.95 0 0 1 3.82-2.8c4.33-.88 6.73 2.44 9.03 5.32Z"></path>
                                                </svg>
                                            </div>
                                            <div class="text-neutral-500 text-sm">3</div>
                                        </button>
                                    </div>
                                </div>
                            </comment-item>

                            <comment-item class="flex gap-3 w-full">
                                <div class="shrink-0 rounded-full size-12 overflow-hidden">
                                    <img src="/media/Laurent_Jouron.png" class="w-full h-full object-cover">
                                </div>
                                <div class="grow flex justify-between">
                                    <div>
                                        <div class="font-medium">Laureent Jouron</div>
                                        <div class="leading-5">C'est un commentaire</div>
                                        <div class="flex gap-4 text-neutral-400 text-sm mt-1">
                                            <span>2h ago</span>
                                            <button>Répondre</button>
                                        </div>
                                    </div>
                                    <div>
                                        <button class="p-2">
                                            <div class="size-5 fill-neutral-500">
                                                <svg viewBox="0 0 48 48">
                                                    <path d="M40.96 24.15c1.83-4.8 1.05-8.61-.8-11.33a10.87 10.87 0 0 0-6.34-4.49 9.43 9.43 0 0 0-6.83 1.17c-1.08.65-2.1 1.53-2.99 2.66-.9-1.13-1.9-2.01-3-2.66a9.43 9.43 0 0 0-6.82-1.17 10.87 10.87 0 0 0-6.34 4.49c-1.85 2.72-2.63 6.54-.8 11.33 1.43 3.74 4.5 7.23 7.6 9.98a46.31 46.31 0 0 0 8.6 6.12l.76.4.76-.4a46.31 46.31 0 0 0 8.6-6.12c3.1-2.75 6.17-6.24 7.6-9.98ZM24 17.58c2.3-2.88 4.7-6.2 9.03-5.33a6.95 6.95 0 0 1 3.82 2.81c1.07 1.58 1.76 4.02.37 7.66-1.09 2.86-3.6 5.82-6.51 8.43A44.84 44.84 0 0 1 24 36.09a44.84 44.84 0 0 1-6.7-4.94c-2.93-2.6-5.43-5.57-6.52-8.43-1.4-3.64-.7-6.08.37-7.66a6.95 6.95 0 0 1 3.82-2.8c4.33-.88 6.73 2.44 9.03 5.32Z"></path>
                                                </svg>
                                            </div>
                                            <div class="text-neutral-500 text-sm">3</div>
                                        </button>
                                    </div>
                                </div>
                            </comment-item>
                        </div>
                    </div>
                    <div x-show="selectedTab === 'posts'" x-cloak class="px-8 py-6 overflow-y-auto hide-scrollbar">
                        <div class="grid gap-2 grid-cols-3">
                            {% for post in author_posts %}
                                <article>
                                    <a href="{% url 'posts:post_page' post.uuid %}">
                                        <div class="relative bg-black w-full aspect-[3/4] rounded-lg overflow-hidden">
                                            <img class="w-full h-full object-cover" src="{{ post.image.url }}">
                                            <article-info class="absolute bottom-0 left-0 right-0">
                                                <div class="h-30 w-full bg-gradient-to-t from-black to-transparent opacity-30 rounded-b-lg"></div>
                                                <div class="absolute bottom-0 p-3 flex items-center gap-1 z-10">
                                                    <div class="size-5 fill-white">
                                                        <svg viewBox="0 0 48 48">
                                                            <path d="M40.96 24.15c1.83-4.8 1.05-8.61-.8-11.33a10.87 10.87 0 0 0-6.34-4.49 9.43 9.43 0 0 0-6.83 1.17c-1.08.65-2.1 1.53-2.99 2.66-.9-1.13-1.9-2.01-3-2.66a9.43 9.43 0 0 0-6.82-1.17 10.87 10.87 0 0 0-6.34 4.49c-1.85 2.72-2.63 6.54-.8 11.33 1.43 3.74 4.5 7.23 7.6 9.98a46.31 46.31 0 0 0 8.6 6.12l.76.4.76-.4a46.31 46.31 0 0 0 8.6-6.12c3.1-2.75 6.17-6.24 7.6-9.98ZM24 17.58c2.3-2.88 4.7-6.2 9.03-5.33a6.95 6.95 0 0 1 3.82 2.81c1.07 1.58 1.76 4.02.37 7.66-1.09 2.86-3.6 5.82-6.51 8.43A44.84 44.84 0 0 1 24 36.09a44.84 44.84 0 0 1-6.7-4.94c-2.93-2.6-5.43-5.57-6.52-8.43-1.4-3.64-.7-6.08.37-7.66a6.95 6.95 0 0 1 3.82-2.8c4.33-.88 6.73 2.44 9.03 5.32Z"></path>
                                                        </svg>
                                                    </div>
                                                    <span id="post_like_{{ post.uuid }}" class="text-white">
                                                        {{ post.likes.count }}
                                                    </span>
                                                </div>
                                            </article-info>
                                        </div>
                                    </a>
                                </article>
                            {% endfor %}

                        </div>
                    </div>

                    <add-comment x-show="selectedTab === 'comments'" class="absolute bottom-0 w-full bg-white dark:bg-black px-8 py-6 border-t border-neutral-300 dark:border-neutral-700 z-10">
                        <form x-data="{ input: '' }" class="flex">
                            <input x-model="input" type="text" name="comment" placeholder="Ajoutez un commentaire…" class="grow bg-neutral-100 dark:bg-neutral-800 rounded-lg px-4 py-2 text-sm placeholder-neutral-500 outline-none border border-transparent focus:border-neutral-300 dark:focus:border-neutral-800">
                            <button :type="input ? 'submit' : 'button'" class="shrink-0 ml-2 px-4 font-medium" :class="input ? 'text-[#366BF5]' : 'text-neutral-400 !cursor-not-allowed'">Publier</button>
                        </form>
                    </add-comment>

                </article-comments>
            </div>
        </div>
    </div>
{% endblock %}