<div class="border-b brder-neutral-200 pb-4">
    <p class="font-medium text-2xl">
        Paramètres
    </p>
</div>

<div id="email_block" class="md:flex gap-2 pt-4">
    <div class="w-32 font-medium text-md">Adresse mail</div>
    <div class="grow">
        <span>{{ user.email }}</span>
        {% if form.email.errors %}
            {{ form.email.errors }}
        {% endif %}
    </div>
    <div class="w-18 md:!w-27 ml-auto">
        <button hx-get="{% url 'users:settings' %}?email=true"
                hx-target="#email_block"
                hx-swap="innerHTML"
                class="font-medium text-[#366BF5] hover:underline">
                Modifier
        </button>
    </div>
</div>

<div id="verify_block" class="md:flex gap-2 pt-2 pb-4 border-b border-neutral-200">
    <div class="w-32 font-medium text-md"></div>
    <div class="grow">
        {% if user.emailaddress_set.first.verified %}
            <span class="text-green-600">Vérifiée</span>
        {% else %}
            <span class="text-amber-600">Non vérifiée</span>
        {% endif %}
    </div>
    <div class="w-18 md:!w-27 ml-auto">
        {% if not user.emailaddress_set.first.verified %}
        <input type="hidden" name="email" value="{{ user.email }}">
            <button hx-get="{% url 'users:verification_code' %}"
                    hx-include="input[name='email']"
                    hx-target="#verify-trigger"
                    hx-swap="none"
                    class="font-medium text-[#366BF5] hover:underline">
                    Vérifier
            </button>
            <div id="verify-trigger" class="hidden"
                hx-trigger="htmx:afterSwap"
                hx-get="{% url 'users:settings' %}?verification=true"
                hx-target="#verify_block"
                hx-swap="innerHTML">
            </div>
        {% endif %}
    </div>
</div>

<div id="password_reset_block" class="md:flex gap-2 py-4 border-b border-neutral-200">
    <div class="w-32 font-medium text-md">
        Mot de passe
    </div>
    
    <div class="grow">
        {% if messages %}
            {% for message in messages %}
                {% if forloop.last %}
                    <div 
                        x-data="{ show: true }"
                        x-init="setTimeout(() => show = false, 3000)"
                        x-show="show"
                        x-transition
                        class="text-green-600"
                    >
                    {{ message }}
                </div>
                {% endif %}
            {% endfor %}
        {% else %}
            <span>
                Modifier le mot de passe
            </span>
        {% endif %}
    </div>

    <div class="w-18 md:!w-27 ml-auto">
        <a href="{% url 'account_change_password' %}" class="font-medium text-[#366BF5] hover:underline">
            Modifier
        </a>
    </div>
</div>

<div id="birthday_block" class="md:flex gap-2 py-4 border-b border-neutral-200">
    <div class="w-32 font-medium text-md">Anniversaire</div>
    <div class="grow">
        <span>{{ user.birthday }}</span>
    </div>
    <div class="w-18 md:!w-27 ml-auto">
        <button hx-get="{% url 'users:settings' %}?birthday=true"
                hx-target="#birthday_block"
                hx-swap="innerHTML"
                class="font-medium text-[#366BF5] hover:underline">
            Modifier
        </button>
    </div>
</div>

<div id="notifications_block" class="md:flex gap-2 py-4 border-b border-neutral-200">
    <div class="w-32 font-medium text-md">Notifications</div>
    <div class="grow">
        <span>Activer ou désactiver les notifications par e-mail</span>
    </div>
    <div class="w-18 md:!w-27 ml-auto">
        <form hx-post="{% url 'users:settings' %}"
            hx-trigger="change"
            hx-swap="none">
            {% csrf_token %}
            <label class="block w-15 h-8 relative">
                <input type="hidden" name="notifications" value="off" />
                <input type="checkbox" name="notifications" class="peer sr-only" {% if user.notifications %}checked{% endif %} />
                <span class="absolute inset-0 cursor-pointer rounded-full bg-neutral-200 peer-checked:bg-green-600 transition-colors duration-200"></span>
                <span class="absolute left-1 top-1 cursor-pointer w-6 h-6 rounded-full bg-white transition-all duration-200 ease-out peer-checked:left-8"></span>
            </label>
        </form>
    </div>
</div>

<div id="account_delete_block" class="md:flex gap-2 py-4">
    <div class="w-32 font-medium text-md">Compte</div>
    <div class="grow">
        <span>La suppression de ce compte est définitive</span>
    </div>
    <div class="w-18 md:!w-27 ml-auto">
        <a href="{% url 'users:delete_account' %}" class="font-medium text-red-600 hover:underline">
            Supprimer
        <a/>
    </div>
</div>